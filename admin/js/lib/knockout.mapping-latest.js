// Knockout Mapping plugin v1.2.3
// (c) 2011 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
// License: Ms-Pl (http://www.opensource.org/licenses/ms-pl.html)

ko.exportSymbol=function(l,r){for(var k=l.split("."),h=window,i=0;i<k.length-1;i++)h=h[k[i]];h[k[k.length-1]]=r};ko.exportProperty=function(l,r,k){l[r]=k};
(function(){function l(a,b){for(var c in b)b.hasOwnProperty(c)&&b[c]&&(a[c]&&!(a[c]instanceof Array)?l(a[c],b[c]):a[c]=b[c])}function r(a,b){var c={};l(c,a);l(c,b);return c}function k(a){if(a&&typeof a==="object"&&a.constructor==(new Date).constructor)return"date";return typeof a}function h(a,b){a=a||{};if(a.create instanceof Function||a.key instanceof Function||a.arrayChanged instanceof Function)a={"":a};if(b)a.ignore=i(b.ignore,a.ignore),a.include=i(b.include,a.include),a.copy=i(b.copy,a.copy);
a.ignore=i(a.ignore,f.ignore);a.include=i(a.include,f.include);a.copy=i(a.copy,f.copy);a.mappedProperties={};return a}function i(a,b){a instanceof Array||(a=k(a)==="undefined"?[]:[a]);b instanceof Array||(b=k(b)==="undefined"?[]:[b]);return a.concat(b)}function A(a){var b=ko.dependentObservable;ko.dependentObservable=function(a,b,d){d=d||{};d.deferEvaluation=!0;a=new x(a,b,d);a.__ko_proto__=x;return a};a=a();ko.dependentObservable=b;return a}function t(a,b,c,e,d,i,u){var f=ko.utils.unwrapObservable(b)instanceof
Array,u=u||"";if(ko.mapping.isMapped(a))var p=ko.utils.unwrapObservable(a)[m],c=r(p,c);var j=function(){return c[d]&&c[d].create instanceof Function},e=e||new B;if(e.get(b))return a;d=d||"";if(f){var f=[],p=!1,g=function(a){return a};if(c[d]&&c[d].key)g=c[d].key,p=!0;var l=function(a){return a};j()&&(l=function(a){return c[d].create({data:a,parent:i})});if(!ko.isObservable(a))a=ko.observableArray([]),a.mappedRemove=function(b){var c=typeof b=="function"?b:function(a){return a===g(b)};return a.remove(function(a){return c(g(a))})},
a.mappedRemoveAll=function(b){var c=v(b,g);return a.remove(function(a){return ko.utils.arrayIndexOf(c,g(a))!=-1})},a.mappedDestroy=function(b){var c=typeof b=="function"?b:function(a){return a===g(b)};return a.destroy(function(a){return c(g(a))})},a.mappedDestroyAll=function(b){var c=v(b,g);return a.destroy(function(a){return ko.utils.arrayIndexOf(c,g(a))!=-1})},a.mappedIndexOf=function(b){var c=v(a(),g),b=g(b);return ko.utils.arrayIndexOf(c,b)},a.mappedCreate=function(b){if(a.mappedIndexOf(b)!==
-1)throw Error("There already is an object with the key that you specified.");b=l(b);a.push(b);return b};var j=v(ko.utils.unwrapObservable(a),g).sort(),h=v(b,g);p&&h.sort();for(var p=ko.utils.compareArrays(j,h),j={},h=[],n=0,x=p.length;n<x;n++){var s=p[n],q,o=u+"["+n+"]";switch(s.status){case "added":var w=y(ko.utils.unwrapObservable(b),s.value,g);q=ko.utils.unwrapObservable(t(void 0,w,c,e,d,a,o));o=C(ko.utils.unwrapObservable(b),w,j);h[o]=q;j[o]=!0;break;case "retained":w=y(ko.utils.unwrapObservable(b),
s.value,g);q=y(a,s.value,g);t(q,w,c,e,d,a,o);o=C(ko.utils.unwrapObservable(b),w,j);h[o]=q;j[o]=!0;break;case "deleted":q=y(a,s.value,g)}f.push({event:s.status,item:q})}a(h);c[d]&&c[d].arrayChanged&&ko.utils.arrayForEach(f,function(a){c[d].arrayChanged(a.event,a.item)})}else if(z(b)){if(!a)if(j())return A(function(){return c[d].create({data:b,parent:i})});else a={};e.save(b,a);D(b,function(d){var g=u.length?u+"."+d:d;if(ko.utils.arrayIndexOf(c.ignore,g)==-1)if(ko.utils.arrayIndexOf(c.copy,g)!=-1)a[d]=
b[d];else{var f=e.get(b[d]);a[d]=f?f:t(a[d],b[d],c,e,d,a,g);c.mappedProperties[g]=!0}})}else switch(k(b)){case "function":a=b;break;default:ko.isWriteableObservable(a)?a(ko.utils.unwrapObservable(b)):a=j()?A(function(){return c[d].create({data:b,parent:i})}):ko.observable(ko.utils.unwrapObservable(b))}return a}function C(a,b,c){for(var e=0,d=a.length;e<d;e++)if(c[e]!==!0&&a[e]==b)return e;return null}function E(a,b){var c;b&&(c=b(a));k(c)==="undefined"&&(c=a);return ko.utils.unwrapObservable(c)}function y(a,
b,c){a=ko.utils.arrayFilter(ko.utils.unwrapObservable(a),function(a){return E(a,c)===b});if(a.length==0)throw Error("When calling ko.update*, the key '"+b+"' was not found!");if(a.length>1&&z(a[0]))throw Error("When calling ko.update*, the key '"+b+"' was not unique!");return a[0]}function v(a,b){return ko.utils.arrayMap(ko.utils.unwrapObservable(a),function(a){return b?E(a,b):a})}function D(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(c);else for(c in a)b(c)}function z(a){var b=k(a);return b==
"object"&&a!==null&&b!=="undefined"}function B(){var a=[],b=[];this.save=function(c,e){var d=ko.utils.arrayIndexOf(a,c);d>=0?b[d]=e:(a.push(c),b.push(e))};this.get=function(c){c=ko.utils.arrayIndexOf(a,c);return c>=0?b[c]:void 0}}ko.mapping={};var m="__ko_mapping__",x=ko.dependentObservable,n={include:["_destroy"],ignore:[],copy:[]},f=n;ko.mapping.fromJS=function(a,b,c){if(arguments.length==0)throw Error("When calling ko.fromJS, pass the object you want to convert.");var b=h(b),e=t(c,a,b);e[m]=r(e[m],
b);return e};ko.mapping.fromJSON=function(a,b){var c=ko.utils.parseJson(a);return ko.mapping.fromJS(c,b)};ko.mapping.isMapped=function(a){return(a=ko.utils.unwrapObservable(a))&&a[m]};ko.mapping.updateFromJS=function(a,b){if(arguments.length<2)throw Error("When calling ko.updateFromJS, pass: the object to update and the object you want to update from.");if(!a)throw Error("The object is undefined.");if(!a[m])throw Error("The object you are trying to update was not created by a 'fromJS' or 'fromJSON' mapping.");
return t(a,b,a[m])};ko.mapping.updateFromJSON=function(a,b,c){b=ko.utils.parseJson(b);return ko.mapping.updateFromJS(a,b,c)};ko.mapping.toJS=function(a,b){f||ko.mapping.resetDefaultOptions();if(arguments.length==0)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");if(!(f.ignore instanceof Array))throw Error("ko.mapping.defaultOptions().ignore should be an array.");if(!(f.include instanceof Array))throw Error("ko.mapping.defaultOptions().include should be an array.");
if(!(f.copy instanceof Array))throw Error("ko.mapping.defaultOptions().copy should be an array.");b=h(b,a[m]);return ko.mapping.visitModel(a,function(a){return ko.utils.unwrapObservable(a)},b)};ko.mapping.toJSON=function(a,b){var c=ko.mapping.toJS(a,b);return ko.utils.stringifyJson(c)};ko.mapping.defaultOptions=function(){if(arguments.length>0)f=arguments[0];else return f};ko.mapping.resetDefaultOptions=function(){f={include:n.include.slice(0),ignore:n.ignore.slice(0),copy:n.copy.slice(0)}};ko.mapping.visitModel=
function(a,b,c){c=c||{};c.visitedObjects=c.visitedObjects||new B;c.parentName||(c=h(c));var e,d=ko.utils.unwrapObservable(a);if(z(d))b(a,c.parentName),e=d instanceof Array?[]:{};else return b(a,c.parentName);c.visitedObjects.save(a,e);var f=c.parentName;D(d,function(a){if(!(c.ignore&&ko.utils.arrayIndexOf(c.ignore,a)!=-1)){var h=d[a],i=c,j=f||"";d instanceof Array?f&&(j+="["+a+"]"):(f&&(j+="."),j+=a);i.parentName=j;if(!(ko.utils.arrayIndexOf(c.copy,a)===-1&&ko.utils.arrayIndexOf(c.include,a)===-1&&
d[m]&&d[m].mappedProperties&&!d[m].mappedProperties[a]&&!(d instanceof Array)))switch(k(ko.utils.unwrapObservable(h))){case "object":case "undefined":i=c.visitedObjects.get(h);e[a]=k(i)!=="undefined"?i:ko.mapping.visitModel(h,b,c);break;default:e[a]=b(h,c.parentName)}}});return e};ko.exportSymbol("ko.mapping",ko.mapping);ko.exportSymbol("ko.mapping.fromJS",ko.mapping.fromJS);ko.exportSymbol("ko.mapping.fromJSON",ko.mapping.fromJSON);ko.exportSymbol("ko.mapping.isMapped",ko.mapping.isMapped);ko.exportSymbol("ko.mapping.defaultOptions",
ko.mapping.defaultOptions);ko.exportSymbol("ko.mapping.toJS",ko.mapping.toJS);ko.exportSymbol("ko.mapping.toJSON",ko.mapping.toJSON);ko.exportSymbol("ko.mapping.updateFromJS",ko.mapping.updateFromJS);ko.exportSymbol("ko.mapping.updateFromJSON",ko.mapping.updateFromJSON);ko.exportSymbol("ko.mapping.visitModel",ko.mapping.visitModel)})();
